<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üé≤ Lotomania - Resultados</title>
  <!-- ‚úÖ ADICIONAR ESTA LINHA: -->
  <script src="js/config.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f78100 0%, #d16d00 100%);
      min-height: 100vh;
      padding: 10px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Header */
    header {
      background: white;
      border-radius: 5px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 2px;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .icon-large {
      font-size: 3rem;
    }

    h1 {
      font-size: 1.5rem;
      color: #f78100;
      margin-bottom: 5px;
    }

    .subtitle {
      color: #666;
      font-size: 1rem;
    }

    .btn-voltar {
      padding: 12px 24px;
      background: #f78100;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      transition: opacity 0.3s;
    }

    .btn-voltar:hover {
      opacity: 0.9;
    }

    /* Tabela */
    .tabela-container {
      background: white;
      border-radius: 5px;
      padding: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
      font-size: 1.2rem;
    }

    .loading::after {
      content: "...";
      animation: dots 1.5s steps(4, end) infinite;
    }

    @keyframes dots {

      0%,
      20% {
        content: ".";
      }

      40% {
        content: "..";
      }

      60%,
      100% {
        content: "...";
      }
    }

    /* =========================
        CARDS 10x100 LOTOMANIA
      ========================= */

    .cards-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
    }

    .card-concurso {
      background: #fff;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
    }

    .card-header {
      font-weight: bold;
      color: #f78100;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      font-size: 0.95rem;
    }

    .card-concurso:first-child {
      border: 2px solid #f78100;
    }

    .grid-100 {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      gap: 6px;
    }

    .dezena {
      aspect-ratio: 1 / 1;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      font-weight: bold;
      background: #eee;
      color: #666;
    }

    .dezena.sorteada {
      background: #f78100;
      color: #fff;
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Header -->
    <header>
      <div class="header-left">
        <div class="icon-large">üé≤</div>
        <div>
          <h1>Lotomania</h1>
          <div class="subtitle">Resultados</div>
        </div>
      </div>
      <a href="index.html" class="btn-voltar">‚Üê Voltar</a>
    </header>

    <!-- Tabela -->
    <div class="tabela-container">
      <div id="loading" class="loading">Carregando resultados</div>

      <div id="cards-resultados" class="cards-container" style="display: none"></div>
    </div>
  </div>

  <script>
    const ENDPOINT = "/lotomania";

    const LIMITE = 10;

    // ‚úÖ Pegar token do localStorage
    function getToken() {
      return localStorage.getItem("token");
    }

    // ‚úÖ Criar headers com autentica√ß√£o
    function getHeaders() {
      const token = getToken();
      return {
        Authorization: `Bearer ${token}`,
        "Content-Type": "application/json",
      };
    }

    // ‚úÖ Verificar se est√° autenticado
    function verificarAutenticacao() {
      const token = getToken();
      if (!token) {
        alert("Voc√™ precisa fazer login!");
        window.location.href = "login.html";
        return false;
      }
      return true;
    }

    // Carregar dados iniciais
    async function carregarDados() {
      if (!verificarAutenticacao()) return;
      await carregarResultados();
    }

    async function carregarResultados() {
      const loading = document.getElementById("loading");
      const cards = document.getElementById("cards-resultados");

      loading.style.display = "block";
      cards.style.display = "none";

      try {
        // ‚úÖ Adicionar token na requisi√ß√£o
        const response = await fetch(
          `${API_URL}${ENDPOINT}?limit=${LIMITE}`,
          { headers: getHeaders() },
        );

        const data = await response.json();

        if (data.success) {
          renderizarCards(data.data);
          loading.style.display = "none";
          cards.style.display = "grid";
        } else {
          loading.textContent = "‚ùå Nenhum resultado encontrado";
        }
      } catch (error) {
        console.error(error);
        loading.textContent = "‚ùå Erro ao carregar resultados";
      }
    }

    function gerarGrid(dezenasSorteadas) {
      let html = "";

      for (let i = 1; i <= 100; i++) {
        html += `
            <div class="dezena ${dezenasSorteadas.includes(i) ? "sorteada" : ""}">
              ${String(i).padStart(2, "0")}
            </div>
          `;
      }

      return html;
    }

    function renderizarCards(resultados) {
      resultados.sort((a, b) => b.concurso - a.concurso);
      const container = document.getElementById("cards-resultados");
      container.innerHTML = "";

      resultados.forEach((resultado) => {
        const dezenasSorteadas = (
          resultado.dezenas ||
          resultado.dezenas_1 ||
          []
        ).map((n) => parseInt(n));

        const card = document.createElement("div");
        card.className = "card-concurso";

        card.innerHTML = `
            <div class="card-header">
              <span>Concurso #${resultado.concurso}</span>
              <span>${resultado.data || ""}</span>
            </div>
            <div class="grid-100">
              ${gerarGrid(dezenasSorteadas)}
            </div>
          `;

        container.appendChild(card);
      });
    }

    // ‚úÖ Carregar ao iniciar (ap√≥s verificar auth)
    carregarDados();
  </script>
  <script src="js/auth-check.js"></script>
  <script>
    // Autentica√ß√£o b√°sica
    if (verificarAutenticacao()) {
      // üö´ Verifica√ß√£o do plano
      verificarPlanoPro();
    }
  </script>
</body>

</html>