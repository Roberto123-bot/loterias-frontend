<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>üìä Estat√≠sticas - Sistema de Loterias</title>

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />

    <script src="js/config.js"></script>

    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 1px;
      }

      .container {
        max-width: 100%;
        margin: 0 auto;
      }

      header {
        background: white;
        border-radius: 5px;
        padding: 20px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      h1 {
        font-size: 1.8rem;
        color: #333;
      }

      .btn-voltar {
        background: #667eea;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        text-decoration: none;
      }

      .cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
      }

      .card {
        background: white;
        border-radius: 5px;
        padding: 20px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      }

      .card h3 {
        margin-bottom: 10px;
        font-size: 1.1rem;
      }

      /* ===== Tooltip ===== */
      /* √çcone do tooltip */
      .tooltip-icon {
        font-size: 1rem;
        color: #667eea;
        vertical-align: middle;
        cursor: pointer;
        transition:
          transform 0.2s ease,
          opacity 0.2s ease;
      }

      .tooltip-icon:hover {
        transform: scale(1.1);
        opacity: 0.85;
      }

      .tooltip-container {
        position: relative;
        display: inline-block;
        margin-left: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        color: #667eea;
      }

      .tooltip-text {
        visibility: hidden;
        opacity: 0;
        width: 260px;
        background: #1f2937;
        color: #fff;
        text-align: left;
        padding: 12px;
        border-radius: 8px;
        position: absolute;
        z-index: 10;
        top: 120%;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.8rem;
        line-height: 1.4;
        transition: opacity 0.3s ease;
      }

      .tooltip-text::after {
        content: "";
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        border-width: 6px;
        border-style: solid;
        border-color: transparent transparent #1f2937 transparent;
      }

      .tooltip-container:hover .tooltip-text {
        visibility: visible;
        opacity: 1;
      }

      /* Mobile: tooltip por toque */
      @media (max-width: 768px) {
        .tooltip-text {
          width: 90vw;
        }
      }

      /* ===== Linha estilo tabela dentro dos cards ===== */
      .linha-estat {
        display: grid;
        grid-template-columns: 40px 1fr;
        gap: 8px;
        align-items: center;
        padding: 6px 0;
        border-bottom: 1px solid #eee;
        font-size: 0.9rem;
      }

      .linha-estat:last-child {
        border-bottom: none;
      }

      .linha-estat .dezena {
        font-weight: 700;
        text-align: center;
      }

      .linha-estat .dados {
        display: grid;
        grid-template-columns: repeat(3, auto);
        gap: 12px;
        color: #555;
        font-size: 0.8rem;
      }

      .linha-estat .dados span {
        white-space: nowrap;
      }

      /* √çcones */
      .linha-estat.forte .dezena {
        color: #e11d48;
      }
      .linha-estat.fraca .dezena {
        color: #2563eb;
      }
      .linha-estat.atraso .dezena {
        color: #7c3aed;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <header>
        <h2>üìä Estat√≠sticas</h2>
        <a href="index.html" class="btn-voltar">‚Üê Voltar</a>
      </header>

      <!-- Cards resumo -->
      <section class="cards">
        <div class="card" id="card-top5">
          <h3>
            üî• Top 5 Dezenas Fortes
            <span class="tooltip-container">
              <i class="bi bi-info-circle-fill tooltip-icon"></i>
              <span class="tooltip-text">
                <strong>O que √© o Score?</strong><br /><br />
                O Score √© um √≠ndice estat√≠stico de tend√™ncia calculado com base
                em:
                <br />‚Ä¢ Frequ√™ncia da dezena <br />‚Ä¢ Sequ√™ncia de apari√ß√µes
                <br />‚Ä¢ Atraso nos concursos <br /><br />
                F√≥rmula utilizada:<br />
                <code>(Freq √ó 2) + (Seq √ó 3) ‚àí (Atraso √ó 2)</code>
                <br /><br />
                <em>N√£o representa garantia ou previs√£o de resultado.</em>
              </span>
            </span>
          </h3>

          <div class="conteudo"></div>
        </div>

        <div class="card" id="card-bottom5">
          <h3>‚ùÑÔ∏è Top 5 Dezenas Fracas</h3>
          <div class="conteudo"></div>
        </div>

        <div class="card" id="card-atrasos">
          <h3>‚è±Ô∏è Atrasos Cr√≠ticos</h3>
          <div class="conteudo"></div>
        </div>

        <div class="card" id="card-temperatura">
          <h3>üå°Ô∏è Temperatura Geral</h3>
          <div class="conteudo"></div>
        </div>
      </section>
    </div>

    <script>
      document.querySelectorAll(".tooltip-container").forEach((t) => {
        t.addEventListener("click", () => {
          const tip = t.querySelector(".tooltip-text");
          tip.style.visibility =
            tip.style.visibility === "visible" ? "hidden" : "visible";
          tip.style.opacity = tip.style.opacity === "1" ? "0" : "1";
        });
      });

      function carregarEstatisticas() {
        const dados = localStorage.getItem("estatisticasMapa");

        if (!dados) {
          alert(
            "Nenhuma estat√≠stica encontrada. Acesse o Mapa das Dezenas primeiro.",
          );
          window.location.href = "mapa-dezenas.html";
          return;
        }

        return JSON.parse(dados);
      }

      function calcularScore(est) {
        return est.frequencia.map((f, i) => ({
          dezena: est.min + i,
          freq: f,
          seq: est.sequencia[i],
          atraso: est.atraso[i],
          score: f * 2 + est.sequencia[i] * 3 - est.atraso[i] * 2,
        }));
      }

      function obterTop5(scores) {
        const ordenado = [...scores].sort((a, b) => b.score - a.score);

        return {
          fortes: ordenado.slice(0, 5),
          fracas: ordenado.slice(-5).reverse(),
        };
      }

      function renderTop5Fortes(lista) {
        const container = document.querySelector("#card-top5 .conteudo");
        container.innerHTML = "";

        lista.forEach((d) => {
          const div = document.createElement("div");
          div.className = "linha-estat forte";
          div.innerHTML = `
            <div class="dezena"> ${d.dezena}</div>
            <div class="dados">
              <span>Score <strong>${d.score}</strong></span>
              <span>Freq <strong>${d.freq}</strong></span>
              <span>Seq <strong>${d.seq}</strong></span>
            </div>
          `;
          container.appendChild(div);
        });
      }

      function renderTop5Fracas(lista) {
        const container = document.querySelector("#card-bottom5 .conteudo");
        container.innerHTML = "";

        lista.forEach((d) => {
          const div = document.createElement("div");
          div.className = "linha-estat fraca";
          div.innerHTML = `
            <div class="dezena"> ${d.dezena}</div>
            <div class="dados">
              <span>Score <strong>${d.score}</strong></span>
              <span>Freq <strong>${d.freq}</strong></span>
              <span>Atraso <strong>${d.atraso}</strong></span>
            </div>
          `;
          container.appendChild(div);
        });
      }

      function calcularTemperaturaGeral(est) {
        const total = est.temperatura.length;

        const quentes = est.temperatura.filter((t) => t === "Q").length;
        const mornas = est.temperatura.filter((t) => t === "M").length;
        const frias = est.temperatura.filter((t) => t === "F").length;

        return {
          quentes,
          mornas,
          frias,
          total,
          pctQ: Math.round((quentes / total) * 100),
          pctM: Math.round((mornas / total) * 100),
          pctF: Math.round((frias / total) * 100),
        };
      }

      function renderAtrasosCriticos(est) {
        const lista = calcularAtrasosCriticos(est);
        const container = document.querySelector("#card-atrasos .conteudo");
        container.innerHTML = "";

        lista.forEach((d) => {
          const div = document.createElement("div");
          div.className = "linha-estat atraso";
          div.innerHTML = `
            <div class="dezena"> ${d.dezena}</div>
            <div class="dados">
              <span>Atraso <strong>${d.atraso}</strong></span>
              <span>Freq <strong>${d.freq}</strong></span>
            </div>
          `;
          container.appendChild(div);
        });
      }

      function calcularAtrasosCriticos(est) {
        return est.atraso
          .map((a, i) => ({
            dezena: est.min + i,
            atraso: a,
            freq: est.frequencia[i],
          }))
          .filter((d) => d.atraso > 0)
          .sort((a, b) => b.atraso - a.atraso)
          .slice(0, 5);
      }

      function renderTemperaturaGeral(est) {
        const temp = calcularTemperaturaGeral(est);
        const container = document.querySelector("#card-temperatura .conteudo");

        container.innerHTML = `
          üî• <strong>Quentes:</strong> ${temp.quentes} (${temp.pctQ}%)<br>
          üå§Ô∏è <strong>Mornas:</strong> ${temp.mornas} (${temp.pctM}%)<br>
          ‚ùÑÔ∏è <strong>Frias:</strong> ${temp.frias} (${temp.pctF}%)

          <div style="margin-top:12px">
            <div style="height:10px; background:#eee; border-radius:5px; overflow:hidden;">
              <div style="width:${temp.pctQ}%; background:#ff5c8a; height:100%; float:left;"></div>
              <div style="width:${temp.pctM}%; background:#ffd166; height:100%; float:left;"></div>
              <div style="width:${temp.pctF}%; background:#4dabf7; height:100%; float:left;"></div>
            </div>
          </div>
        `;
      }

      const estat = carregarEstatisticas();
      const scores = calcularScore(estat);
      const { fortes, fracas } = obterTop5(scores);

      renderTop5Fortes(fortes);
      renderTop5Fracas(fracas);
      renderAtrasosCriticos(estat);
      renderTemperaturaGeral(estat);
    </script>

    <script src="js/auth-check.js"></script>
  </body>
</html>
